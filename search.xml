<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>커스텀 도커 이미지로 CircleCI 빌드 시간 단축하기</title>
      <link href="/2017/10/18/Save-your-CircleCI-build-time-with-custom-docker-image/"/>
      <content type="html"><![CDATA[<p>고객이 증가합니다. 비즈니스 요구사항이 다양해집니다. 규모가 커집니다. 서비스의 성장과 함께 자연스럽게 겪는 일입니다. 이런 상황에서 기술적으로 복잡하거나 어려운 문제를 마주하게 되는데 이를 해결하는 것은 곤욕스러울 때도 있지만 대체로 즐거운 경험으로 남아 있었던것 같습니다… (!?) <a id="more"></a></p><hr><h3 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h3><p>최근 팀 내에서 일부 비즈니스 요구사항을 커버하기 위해 기술적인 도전이라고 볼 수 있는 프로젝트를 진행하기로 결정, 한창 진행 중입니다. DynamoDB의 일부 테이블에 해당하는 데이터는 PostgreSQL에도 함께 적재하도록 처리하는 서버를 만들기로 했는데요. 이런 일련의 과정을 거치는 이유는 DynamoDB로 풀기 힘든 문제들이 당면해 있는 요구사항과 부딪혔기 때문입니다. (RDB에서 어렵지 않게 할 수 있는 통계 및 집계성 쿼리 기능들과 상충합니다.)</p><p>이 프로젝트에서 저는 주로 개발 환경을 만드는 일들을 진행해왔습니다. 몇 가지 나열해 보자면 미리 사용하기로 한 기술들을 조합하여 로컬에서 개발 환경으로 프로젝트를 구동할 수 있도록 데이터베이스를 설정하고 애플리케이션 빌드 및 테스팅, 코드단 스케폴딩을 마련하는 것과 프로덕션 환경에 배포하고 모니터링 할 수 있는 기반을 만들거나 CI를 설정하고 설정한 CI와 저장소를 연동하는 일들이었습니다.</p><hr><h3 id="Stack-that-we-use"><a href="#Stack-that-we-use" class="headerlink" title="Stack that we use"></a>Stack that we use</h3><p>제가 속한 팀에서 운영중인 프로젝트 대부분은 CI를 활용 중이며 CircleCI를 사용하고 있습니다. 서비스간 비동기 처리를 위한 메시지 큐 + 앱 푸시 등을 처리하는 worker, 비즈니스 로직(동적 컨텐츠 반환, 결제 처리, 채팅 연결 등)를 처리하기 위한 GraphQL + 소켓 서버, 고객에게 앱을 제공하기 위한 React Native 클라이언트 등등 대부분 AWS EB + CircleCI + Github 조합으로 빌드, 배포 자동화가 되어 있습니다. 이번에 구축하는 프로젝트 역시 동일한 구성을 사용하기로 했습니다. 종전 프로젝트와 다른 점은 CircleCI 2.0을 사용하는 것인데요. 1.0과 가장 큰 차이는 도커를 native로 지원하는 거라고 볼 수 있을 것 같습니다.</p><p>빌드 과정을 간략하게 설명하자면 특정 브랜치가 푸시되면 CircleCI는 해당 저장소의 <code>.circleci/config.yml</code> 을 기준으로 빌드를 시작합니다. 빌드가 진행되는 동안 작업자가 PR을 작성하면 다른 동료들의 코드 리뷰를 받게 됩니다. 리뷰가 통과되고 빌드가 성공했다면 비로소 master 브랜치에 머지를 할 수 있도록 머지 버튼이 활성화되고, 작업자가 머지를 하면 CircleCI 가 한 번 더 빌드를 시작하고 배포까지 수행합니다. (배포는 master 브랜치 기준으로만 수행합니다.)</p><hr><h3 id="CircleCI-with-Docker"><a href="#CircleCI-with-Docker" class="headerlink" title="CircleCI with Docker"></a>CircleCI with Docker</h3><p>예상하셨겠지만 <code>.circleci/config.yml</code> 파일에는 해당 프로젝트를 빌드하거나 테스트 및 배포를 위한 기반 환경을 설정하고 실행하는 명령들이 있습니다. 이해를 돕기 위해 설정 파일의 변경점를 확인해 보시죠.</p><p><img src="/images/circleci-config-diff.png" alt="config.yml 의 개선 전/후"></p><p>좌측이 개선되기 이전의 설정이고, 우측이 개선된 후의 설정입니다. 아무래도 프로젝트가 막 만들어졌고 <code>awsebcli</code>를 설치하는 데  필요한 도구들 외에 다른 게 없어서 별게 없습니다. 개선되기 전인 좌측을 먼저 볼까요? 도커 컨테이너를 실행하기 위한 이미지는 CircleCI에서 제공하는 <code>circleci/node:8.4.0</code> 를 사용하고 있고 저장소를 <code>checkout</code> 한 후 의존하는 패키지를 설치합니다. 이는 실제로 CircleCI 웹 인터페이스에서 확인하면 아래와 같이 동작합니다.</p><p><img src="/images/circleci-build-before.png" alt="`Install dependencies` 항목 우측의 27초를 주목해주세요!"></p><p>이번엔 변경점의 우측을 봅시다. 좌측과 달리 도커 이미지를 <code>huiseoul/alligator:latest</code> 이걸로 사용할 뿐 다른 의존성 패키지 설치 명령어는 삭제되었습니다. 이미 눈치챈 분들도 있으시겠죠? 맞습니다. 의존성 패키지 설치를 <code>huiseoul/alligator:latest</code> 이 도커 이미지 내에 넣었기 때문입니다.</p><figure class="highlight yml"><figcaption><span>Dockerfile of huiseoul/alligator</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">FROM</span>        <span class="string">circleci/node:8.8.1</span></span><br><span class="line"></span><br><span class="line"><span class="string">RUN</span>         <span class="string">sudo</span> <span class="string">apt-get</span> <span class="string">update</span></span><br><span class="line"><span class="string">RUN</span>         <span class="string">sudo</span> <span class="string">apt-get</span> <span class="string">install</span> <span class="bullet">-y</span> <span class="string">python-pip</span> <span class="string">libpython-dev</span></span><br><span class="line"><span class="string">RUN</span>         <span class="string">sudo</span> <span class="string">easy_install</span> <span class="bullet">--upgrade</span> <span class="string">six</span></span><br><span class="line"><span class="string">RUN</span>         <span class="string">sudo</span> <span class="string">pip</span> <span class="string">install</span> <span class="string">awsebcli</span></span><br></pre></td></tr></table></figure><p><img src="/images/circleci-build-after.png" alt="`Install dependencies` 항목이 사라졌습니다."></p><p>자, 이제 우린 의존성 패키지를 미리 설정해둔 도커 이미지덕에 매 빌드마다 27초를 아끼게 됐습니다. 아이러니하게도 의존성 패키지가 많으면 많을수록 아낄 수 있는 시간이 늘어납니다! 이거야말로 마법 아닙니까!? 더군다나 하루에 빌드하는 횟수까지 고려하면 들이는 노력대비 훌륭한 가성비라고 생각합니다.</p><h3 id="Outro"><a href="#Outro" class="headerlink" title="Outro"></a>Outro</h3><p>이전부터 도커에 관심만 있었지 실제 사용해 본 적은 없습니다. 로컬 머신에 도커를 설치하고 기본 사용법을 익혀 이 프로젝트에 맞게 의존성 패키지 설치 스크립트가 포함된 Dockerfile을 만들어서 이미지를 생성하고 도커 허브의 개인 및 조직 계정을 만들어 공개 저장소에 업로드 하는것까지 채 1시간도 걸리지 않았습니다. 이제 걸음마 수준으로 사용하는 단계지만 실제로 사용해보니 기대만큼 좋은 인상을 얻을 수 있었던것 같습니다. 만약 다음에 새로운 프로젝트를 진행하거나 사용할수 있는 상황이 된다면 적극 사용하게 될것 같습니다.</p><h3 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h3><ul><li><a href="https://docs.docker.com/" target="_blank" rel="noopener">Docker Docs</a></li><li><a href="https://circleci.com/docs/2.0/" target="_blank" rel="noopener">CircleCI 2.0 Docs</a></li></ul>]]></content>
      
      
        <tags>
            
            <tag> circleci </tag>
            
            <tag> docker </tag>
            
            <tag> ci </tag>
            
            <tag> build </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Git 의 submodule 을 사용하여 Hexo 에 테마 추가하기</title>
      <link href="/2017/04/04/How-to-add-a-theme-on-Hexo-using-submodule/"/>
      <content type="html"><![CDATA[<p>언젠가 Git을 사용하면서 그런 적이 있다. 내 저장소의 특정 위치에 다른 저장소를 연결하는 방법은 없을까? 간혹 그런 생각이 들 때마다 있겠거니 하고 그냥 넘어갔었는데 마침 이번에 Hexo 를 설치하고 테마를 설정하다 보니 딱 필요한 상황이 생겨서 정리해본다. <a id="more"></a></p><hr><h3 id="submodule"><a href="#submodule" class="headerlink" title="submodule?"></a>submodule?</h3><blockquote><p>A submodule allows you to keep another Git repository in a subdirectory of your repository. The other repository has its own history, which does not interfere with the history of the current repository. This can be used to have external dependencies such as third party libraries for example.</p></blockquote><p>내 저장소의 특정 subdirectory에 다른 Git저장소를 유지해 주고 커밋 히스토리는 각각 따로 관리하게 된다고 이해하면 될 것 같다. (간단하게 리눅스 쉘의 symbolic link를 떠올리면 될 듯)</p><hr><h3 id="Hexo-테마-설치"><a href="#Hexo-테마-설치" class="headerlink" title="Hexo 테마 설치"></a>Hexo 테마 설치</h3><p>Hexo 내부적으로 <a href="https://hexo.io/docs/themes.html" target="_blank" rel="noopener">테마를 기본적으로 지원</a>하고 어떤 종류의 테마가 퍼블리싱 되어 있는지 <a href="https://hexo.io/themes/" target="_blank" rel="noopener">확인</a>도 할 수 있다. 개인적으로 모던하고 심플하고 감성적이면서 확장성 있고 다양한 디바이스를 지원하는(어디서 많이 본 문구 같다…?) 테마를 찾고 있었기 때문에 고르고 골라 <a href="https://github.com/ahonn/hexo-theme-even" target="_blank" rel="noopener">Even</a>이라는 테마를 선택하게 됐다. 테마를 선택했으니 본격적으로 설정해 보자.</p><ol><li><p>설치할 테마의 저장소 URL을 기억해 둔 다음 로컬의 저장소 루트로 이동해서 Git 명령어를 써서 submodule을 추가하자. 마지막 인자는 submodule을 설정할 경로.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> git submodule add https://github.com/ahonn/hexo-theme-even themes/even</span><br></pre></td></tr></table></figure></li><li><p>별 문제가 없다면 해당 저장소를 클론 받는걸 볼 수 있고 루트에 <code>.gitmodules</code> 파일이 생성되며 <code>./themes/even</code> 디렉토리가 생성된걸 <code>git status</code>로 확인할 수 있다. </p></li><li><p>이제 Hexo 에 <code>나 이 테마 쓸거야~</code> 하고 알려줘야 한다. 루트의 <code>_config.yml</code>을 열어서 <code>theme</code> 속성의 값을 <code>even</code>으로 수정하고 로컬에서 서버를 올려보자.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> hexo s -o</span><br></pre></td></tr></table></figure></li><li><p>곧 브라우저가 열리고 테마가 잘 반영된걸 확인했다면 커밋 &amp; 푸시로 마무리하자.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> git commit -m 'feat: add `even` theme' &amp;&amp; git push origin hexo</span><br></pre></td></tr></table></figure></li><li><p>Github으로 발행까지 하면 리모트에 테마가 반영된걸 확인해 볼수 있다!</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> hexo deploy</span><br></pre></td></tr></table></figure></li><li><p>추가로 해당 테마에서 지원하는 여러 가지 부가적인 기능들이 있는데 테마 자체적으로 지원하는 기능 외에도 Hexo에서 지원하는 플러그인 기능까지 활용하고 있다. (SCSS renderer, 본문 검색 등) 자세한 내용은 위키에서 확인할 수 있는데 중국어의 압박이 있으니 인내심을 갖고 설정하자. (같은 메뉴를 몇 번째 클릭하는지…ㅠㅠ)</p></li><li>추후 다른 환경에 자신이 만든 저장소를 클론해야 할 일이 생길 텐데 단순히 클론만 받으면 하위 경로에 있는 submodule까지 클론하지 않는다. 아래 명령어를 사용하여 해결하자.<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> git submodule update --init --recursive</span><br></pre></td></tr></table></figure></li></ol><hr><h3 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h3><ul><li><a href="https://git-scm.com/docs/git-submodule#_description" target="_blank" rel="noopener">Git submodule</a></li><li><a href="https://git-scm.com/book/ko/v2/Git-%EB%8F%84%EA%B5%AC-%EC%84%9C%EB%B8%8C%EB%AA%A8%EB%93%88" target="_blank" rel="noopener">Git submodule(한글)</a></li><li><a href="http://stackoverflow.com/questions/1030169/easy-way-pull-latest-of-all-submodules" target="_blank" rel="noopener">쉽게 모든 submodule 을 pull 받는 방법</a></li><li><a href="https://github.com/ahonn/hexo-theme-even/wiki" target="_blank" rel="noopener">Even 테마 위키</a></li></ul>]]></content>
      
      
        <tags>
            
            <tag> hexo </tag>
            
            <tag> theme </tag>
            
            <tag> even </tag>
            
            <tag> submodule </tag>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>정적 블로그 Hexo 설치하기</title>
      <link href="/2017/02/13/How-to-inatall-a-static-blog-with-Hexo/"/>
      <content type="html"><![CDATA[<p>최근에 부쩍 정적 블로그 엔진에 관심이 생겼다. 이미 워드프레스 기반의 블로그를 갖고 있긴 했지만 그 공간은 개발 이야기와는 동떨어진 컨셉이라 개발 이야기만 할수 있는 블로그를 만들기로 결심했다. 이미 정적 블로그 엔진을 사용하여 블로그를 운영 중인 지인들에게 추천을 받기도 하고 구글링도 해 보니 꽤나 다양한 종류의 엔진들이 포진해 있었다. 기술적으로 무언가를 골라야 하는 상황이 되면 조금이라도 내 상황에 맞게 목적에 부합하는걸 찾고자 하는 성격 탓에 어떨 때는 리서치하는 시간보다 선택하는 시간이 오래 걸리기도 한다. <a id="more"></a> 결과적으로 <a href="https://hexo.io/ko/" target="_blank" rel="noopener">Hexo</a>를 사용하기로 했는데 몇가지 이유가 있다. Node.js 기반이다. 최근 2년여간 주로 Node.js를 사용했기 때문에 익숙하고 편하다. 다른 정적 블로그 엔진보다 설치와 사용법이 간단해 보였다. (이후 <a href="https://www.staticgen.com/" target="_blank" rel="noopener">StaticGen</a>이라는 사이트를 발견해서 결정을 번복할 뻔 했지만, 이미 템플릿이나 설정 등을 모두 마친 상태에서 발견했으므로 더 이상의 고민은 하지 않기로 했다;)</p><hr><h3 id="Hexo-설치"><a href="#Hexo-설치" class="headerlink" title="Hexo 설치"></a>Hexo 설치</h3><ol><li>아래 내용은 Node.js, Yarn, Git이 로컬에 설치돼 있다는 가정하에 설명한다.</li><li><p>다른 정적 블로그 퍼블리싱 도구들이 그렇듯 Hexo도 CLI 기반이다.  <code>hero-cli</code> 패키지를 <code>global</code>로 설치하자.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> yarn global add hexo-cli</span><br></pre></td></tr></table></figure></li><li><p>Hexo 구동에 필요한 기본 파일들을 설치한다. 직접 디렉토리를 만들거나 특정 디렉토리에 바로 설치할 수 있다. (설치되는 디렉토리, 파일들이 어떤 역할을 하는지 확인하려면 <a href="https://hexo.io/ko/docs/setup.html" target="_blank" rel="noopener">여기</a>를 참고.)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> hexo init // 현재 디렉토리에 초기화</span><br><span class="line"><span class="meta">$</span> hexo init saystone // 또는 saystone 디렉토리를 생성하고 그 안에 초기화</span><br></pre></td></tr></table></figure></li><li><p>여느 블로그 엔진들이 그렇듯 구동에 필요한 모듈들을 설치한다.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> yarn</span><br></pre></td></tr></table></figure></li><li><p>준비가 다 됐으니 서버를 올려보자.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> hexo serve -o</span><br></pre></td></tr></table></figure></li><li><p>곧 브라우저가 열리면서 설치한 블로그를 띄워준다. 친절하게도 포스트 작성, 서버 구동, 정적 파일 생성 및 원격 사이트에 배포하는 방법을 알려주는 포스트를 샘플로 제공하지만, 입맛에 맞게 커스터마이징 하려면 제공해주는 샘플로는 부족하니 이것저것 찾아서 설정해야 하겠다. :)</p></li></ol><hr><h3 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h3><ul><li><a href="https://hexo.io/ko/docs/" target="_blank" rel="noopener">Hexo Official Documentation</a></li><li><a href="https://originerd.github.io/2017/01/21/how-i-set-hexo/" target="_blank" rel="noopener">originerd님의 Hexo 설정기</a></li></ul>]]></content>
      
      
        <tags>
            
            <tag> static-blog </tag>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
  
  
</search>
